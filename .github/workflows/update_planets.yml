name: Daily planets.json Update

on:
  # Run this workflow automatically every day at 00:00 UTC
  schedule:
    - cron: '0 0 * * *'
  # Allow running this workflow manually from the Actions tab
  workflow_dispatch:

  # To prevent multiple workflow runs from accidentally overlapping (e.g. a manual run while a scheduled one is active)
concurrency:
  group: ${{ github.workflow }}
  cancel-in-progress: true

jobs:
  update-planet-data:
    runs-on: ubuntu-latest
    # Safety timeout: job will be canceled if it runs longer than 1 minute
    timeout-minutes: 1
    # Provide only the necessary permissions for the job
    permissions:
      contents: write

    steps:
      # 1. Check out your repository's code so the script can access it
      - name: Checkout repository
        uses: actions/checkout@v4.1.7

      # 2. Set up a Python environment
      - name: Set up Python
        uses: actions/setup-python@v5.1.0
        with:
          python-version: '3.10'

      # 3. Install the 'requests' library needed by the script
      - name: Install dependencies
        run: python -m pip install requests

      # 4. Run the Python script to update the JSON file
      - name: Update planets.json
        run: python ./scripts/update_planets.py

      # 5. Commit the updated file back to your repository if it has changed
      - name: Commit and push if changed
        uses: stefanzweifel/git-auto-commit-action@v5.0.1
        with:
          commit_message: "Automated daily update of planets.json at 0000 UTC."
          file_pattern: 'public/data/json/planets.json'
